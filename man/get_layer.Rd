% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/retrieve.R
\name{get_layer}
\alias{get_layer}
\title{Get a WRI layer with optional spatial subsetting}
\usage{
get_layer(
  layer_id,
  bbox = NULL,
  shapefile = NULL,
  crs = NULL,
  simplify = TRUE,
  simplify_tolerance = 100,
  return_type = c("terra", "stars"),
  verbose = TRUE
)
}
\arguments{
\item{layer_id}{Character. Layer identifier from \code{list_layers()} or
\code{search_layers()}. Currently only "WRI_score" is available (testing).}

\item{bbox}{Numeric vector c(xmin, ymin, xmax, ymax) in any CRS. If NULL,
no bounding box cropping (default NULL). Auto-detects CRS if not specified.}

\item{shapefile}{sf object, file path, or terra::SpatVector. If provided,
data will be cropped to shapefile extent and masked to shapefile boundary
(pixels outside polygon set to NA). Default NULL.}

\item{crs}{CRS of bbox (if NULL, auto-detect). Ignored if shapefile is
provided (shapefile CRS is used). Can be EPSG code, proj4 string, or
sf::st_crs() object. Default NULL.}

\item{simplify}{Logical. Auto-simplify complex geometries to improve
performance? Default TRUE. Set to FALSE to disable (not recommended for
complex shapefiles with >10,000 vertices).}

\item{simplify_tolerance}{Numeric. Simplification tolerance in meters
(EPSG:5070). Default 100m, which is comparable to WRI resolution (90m).
Larger values = more aggressive simplification = fewer vertices.}

\item{return_type}{Character. Output format: "terra" (default) returns
terra::SpatRaster, "stars" returns stars object. Note: stars requires
the stars package to be installed.}

\item{verbose}{Logical. Print progress messages? Default TRUE. Useful for
understanding what the function is doing, especially for slow operations.}
}
\value{
terra::SpatRaster (or stars object if return_type="stars") containing
the requested WRI layer, cropped/masked to the specified extent.
}
\description{
Retrieves a Wildfire Resilience Index (WRI) COG layer from KNB, with
optional cropping to a bounding box or shapefile. Handles CRS
transformations, extent validation, and efficient partial reads via
GDAL's /vsicurl/ driver.
}
\details{
\strong{Spatial subsetting:}
\enumerate{
\item If \code{bbox} provided: Crop to bounding box rectangle
\item If \code{shapefile} provided: Crop to shapefile extent, then mask
to shapefile boundary (pixels outside polygon = NA)
\item If neither: Return full extent (WARNING: 3.5 GB download)
}

\strong{CRS handling:}
All inputs are automatically transformed to EPSG:5070 (native CRS for
WRI COGs). You can provide bbox/shapefile in any CRS:
\itemize{
\item EPSG:4326 (WGS84 lat/lon) - most common
\item EPSG:5070 (Albers Equal Area) - native WRI CRS
\item Any other valid CRS
}

\strong{Efficient streaming:}
Uses GDAL's /vsicurl/ driver to stream COG from KNB without downloading
the entire file. Only the requested tiles are fetched:
\itemize{
\item Full extent: ~3.5 GB
\item Small bbox (50km × 50km): ~15-20 MB
\item Large bbox (200km × 200km): ~200-300 MB
}

\strong{Performance:}
\itemize{
\item Bbox crop: 5-30 seconds (depends on size)
\item Shapefile crop + mask: 10-60 seconds (depends on complexity)
\item Complex shapefiles (>10k vertices): auto-simplified if simplify=TRUE
}
}
\examples{
\dontrun{
# Example 1: Get full extent (WARNING: 3.5 GB)
wri_score <- get_layer("WRI_score")

# Example 2: Get with bounding box (auto-detects WGS84)
wri_sf <- get_layer(
  "WRI_score",
  bbox = c(-122, 37, -121, 38)
)

# Example 3: Get with bounding box in EPSG:5070 (meters)
wri_albers <- get_layer(
  "WRI_score",
  bbox = c(-2000000, 1500000, -1950000, 1550000),
  crs = 5070
)

# Example 4: Get with shapefile
my_area <- sf::st_read("my_study_area.shp")
wri_aoi <- get_layer("WRI_score", shapefile = my_area)

# Example 5: Disable simplification (not recommended)
complex_area <- sf::st_read("complex_boundary.shp")
wri_complex <- get_layer(
  "WRI_score",
  shapefile = complex_area,
  simplify = FALSE
)

# Example 6: Return as stars object
wri_stars <- get_layer(
  "WRI_score",
  bbox = c(-122, 37, -121, 38),
  return_type = "stars"
)
}

}
